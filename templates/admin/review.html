{% extends "base.html" %}
{% block content %}

<h1 class="mb-5">ğŸ“ Abgaben bewerten</h1>

{% if submissions|length == 0 %}
<div class="event-card text-center">
  <p class="text-secondary mb-0">
    ğŸ‰ Aktuell gibt es keine Abgaben.
  </p>
</div>
{% endif %}

{% for submission in submissions %}
<div class="event-card mb-4">

  <!-- Kopfbereich -->
  <div class="d-flex justify-content-between align-items-start mb-3">

    <div>
      <h3 class="mb-1">
        ğŸ‘¥ {{ submission.team_name }}

        {% if submission.points is not none %}
        <span class="badge bg-success ms-2">âœ” bewertet</span>
        {% else %}
        <span class="badge bg-warning text-dark ms-2">â³ offen</span>
        {% endif %}
      </h3>

      <p class="text-secondary mb-0">
        Aufgabe: <strong>{{ submission.task_title }}</strong>
      </p>
    </div>

    <div class="mb-4">
      <button class="btn btn-sm btn-outline-info" type="button" data-bs-toggle="collapse"
        data-bs-target="#code-{{ submission.id }}" aria-expanded="false">
        ğŸ“„ Code anzeigen
      </button>
      <a href="{{ url_for('admin.download_submission', submission_id=submission.id) }}"
        class="btn btn-sm btn-outline-light ms-2">
        â¬‡ï¸ Datei herunterladen
      </a>
    </div>
  </div>

  <div class="collapse mb-4" id="code-{{ submission.id }}">
    <div class="card card-body bg-dark text-light font-monospace"
      style="white-space: pre-wrap; max-height: 400px; overflow-y: auto; font-size: 0.9em;">{{ submission.code }}
    </div>
  </div>

  <hr class="my-4" style="border-color: rgba(255,255,255,0.15);">

  <!-- Bewertungsformular -->
  <form method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <input type="hidden" name="submission_id" value="{{ submission.id }}">

    <div class="row g-4 align-items-end">

      <!-- Punkte -->
      <div class="col-md-3">
        <label class="form-label">
          Punkte
          <span class="text-secondary">
            (0 â€“ {{ submission.max_points }})
          </span>
        </label>

        <input type="number" name="points" class="form-control form-control-lg" min="0"
          max="{{ submission.max_points }}" value="{{ submission.points if submission.points is not none else '' }}"
          placeholder="z. B. {{ submission.max_points }}" required>
      </div>

      <!-- Feedback -->
      <div class="col-md-7">
        <label class="form-label">
          Feedback (optional)
        </label>

        <input type="text" name="feedback" class="form-control form-control-lg" value="{{ submission.feedback or '' }}"
          placeholder="Kurzer Hinweis fÃ¼r das Team">
      </div>

      <!-- Aktionen -->
      <div class="col-md-2 d-flex flex-column gap-2">

        <button class="btn btn-primary w-100">
          {% if submission.points is not none %}
          âœï¸ Bewertung aktualisieren
          {% else %}
          ğŸ’¾ Bewertung speichern
          {% endif %}
        </button>

        {% if submission.points is not none %}
        <button name="soft_reset" value="1" class="btn btn-outline-warning w-100">
          â™»ï¸ Bewertung zurÃ¼cksetzen
        </button>
        {% endif %}

      </div>

    </div>
  </form>

</div>
{% endfor %}

<a href="{{ url_for('admin.dashboard') }}" class="text-secondary">
  â† zurÃ¼ck zum Admin-Dashboard
</a>

{% endblock %}