{% extends "base.html" %}
{% block content %}

<h2>üß© Live Event</h2>

{% if not challenge %}
  <div class="event-card">
    <p class="text-secondary">
      Noch ist kein Event aktiv ‚Äì lehnt euch zur√ºck ‚òï
    </p>
  </div>
{% else %}

<div class="mb-3 text-secondary">
  Team <strong>{{ team }}</strong> ¬∑ {{ challenge.title }}
</div>

{% if status == "RUNNING" %}
  <div class="event-card mb-3">
    ‚è± Restzeit:
    <strong><span id="timer"></span></strong>
  </div>
{% endif %}

<div class="row g-3">

{% for task in tasks %}
  <div class="col-md-6">
    <div class="event-card">

      <h5>{{ task.title }}</h5>
      <p class="text-secondary">{{ task.description }}</p>
      <small>Max Punkte: {{ task.max_points }}</small>

      <hr>

      {% if task.id in submission_map %}
        <span class="badge bg-success">
          ‚úî Abgegeben ({{ submission_map[task.id].points }} Punkte)
        </span>
      {% else %}
        {% if status == "RUNNING" %}
          <form method="post"
                action="/submit/{{ task.id }}"
                enctype="multipart/form-data">

            <input type="file"
                   name="file"
                   accept=".pde"
                   class="form-control mb-2"
                   required>

            <button class="btn btn-outline-light">
              Abgeben
            </button>
          </form>
        {% endif %}
      {% endif %}

    </div>
  </div>
{% endfor %}

</div>
{% endif %}

{% if status == "RUNNING" %}
<script>
let remaining = {{ remaining }};
const timer = document.getElementById("timer");

function updateTimer() {
  if (remaining <= 0) location.reload();
  const min = Math.floor(remaining / 60);
  const sec = remaining % 60;
  timer.innerText =
    String(min).padStart(2, '0') + ":" + String(sec).padStart(2, '0');
  remaining--;
}
updateTimer();
setInterval(updateTimer, 1000);
</script>
{% endif %}

{% endblock %}
